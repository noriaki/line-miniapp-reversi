# E2Eテスト再構築 - 要求・要件整理

## 目的

E2Eテストをリセットし、ゲーム体験の基本動作・表示を確認するシンプルなテストを再構築する。

---

## スコープ

### IN (対象)

- Playwrightを使用したE2Eテスト
- モバイルデバイス
- ゲーム体験の基本動作・表示確認
- GitHub Actions CI 対応
- AIコーディングエージェントが結果確認可能なレポーター形式

### OUT (対象外)

- VRT（Visual Regression Testing）
- LINE連携（LIFF）テスト
- デスクトップブラウザ
- パス機能
- ゲーム終了・リセット機能

---

## テスト要件

### 1. 初期盤面表示

**ユーザーストーリー:** ユーザーがアプリを開くと、正しい初期盤面が表示される

**検証項目:**

- 8x8のゲームボードが表示される
- 初期4石（黒2、白2）が正しい位置に配置されている
- 有効な手のヒント（黄色パルス）が表示される
- プレイヤーのターン表示が「あなたのターン」になっている

---

### 2. 石配置・反転

**ユーザーストーリー:** ユーザーが有効なマスをタップすると、石が置かれ相手の石が反転する

**検証項目:**

- 有効な手にタップすると石が配置される
- 挟まれた相手の石が反転する
- 石数カウントが更新される

---

### 3. ターン切替

**ユーザーストーリー:** ユーザーが石を置くとAIのターンになり、AIが応手するとプレイヤーのターンに戻る

**検証項目:**

- プレイヤーが石を置くとターン表示が「AIのターン」に変わる
- AIが応手するとターン表示が「あなたのターン」に戻る
- 有効な手のヒントがプレイヤーターン時のみ表示される

---

### 4. 無効な手への対応

**ユーザーストーリー:** ユーザーが置けない場所をタップすると、エラーメッセージが表示される

**検証項目:**

- 既に石があるマスをタップするとエラーメッセージが表示される
- 石を反転できないマスをタップするとエラーメッセージが表示される
- エラー後もゲームは継続可能

---

### 5. AI対戦（2往復）

**ユーザーストーリー:** プレイヤーとAIが交互に手を打ち、ゲームが進行する

**検証項目:**

- プレイヤー1手目 → AI応手 → プレイヤー2手目 → AI応手のフローが正常に動作する
- 各ターンでAI思考中表示が出る
- AIが時間内に応手する

---

## 推奨ファイル構成

```
e2e/
├── game-basic.spec.ts    # 全テストを1ファイルに集約
└── (既存ファイルは全削除)
```

**理由:**

- シンプルなテスト範囲のため、1ファイルで管理可能
- テスト間の依存関係や順序が明確になる
- メンテナンス性が高い

---

## 実施タスク

1. **既存E2Eテスト全削除**
   - `e2e/` ディレクトリ内の全specファイル削除

2. **playwright.config.ts 更新**
   - モバイルプロジェクトのみに変更
   - デスクトッププロジェクト削除

3. **新規テストファイル作成**
   - 上記5つの要件をカバーするテストを作成
   - ファイル: `e2e/game-basic.spec.ts`

---

## 実行環境要件

### ローカル実行

- AIコーディングエージェントが結果を確認しやすい形式
- 推奨: `line` または `list` レポーター（テキストベースで読みやすい）
- 失敗時のエラー詳細が標準出力に表示される

### CI (GitHub Actions)

- GitHub Actions ワークフローで実行可能
- 推奨: `github` レポーター（GitHub Actions Summary に結果表示）
- 失敗時はスクリーンショットをアーティファクトとして保存
- ビルド後の静的ファイルサーブで実行（`npx serve out`）

### レポーター設定

```
ローカル: line (default)
CI: github + html（アーティファクト用）
```

---

## 技術的考慮事項

### 要素セレクタ

- data-testid属性を優先使用（安定性のため）
- 例: `[data-testid="game-board"]`, `#a1`~`#h8`, `[data-row="2"][data-col="3"]`

### AIの待機

- AIの応手を待つためのwaitFor/polling戦略が必要
- 3秒タイムアウトを考慮

### モバイル操作

- `tap()` を使用（click()ではなく）
- モバイルビューポート設定が必要
