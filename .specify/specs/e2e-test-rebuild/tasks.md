# Implementation Plan

## Tasks

- [ ] 1. (P) 既存E2Eテストファイルの削除
  - e2eディレクトリ内の11個のspecファイルを全て削除する
  - 対象: ai-game, ai-negative-value-fix, cross-browser-compatibility, element-id-assignment, game-flow, last-move-highlight, move-history, pass-feature, responsive, ui-usability-improvement, wasm-error
  - _Requirements: 7.1_

- [ ] 2. (P) Playwright設定のモバイル専用化
  - デスクトッププロジェクト（chromium）設定を削除し、モバイルプロジェクトのみに変更する
  - Pixel 5（Chrome）とiPhone 12（Safari）の2デバイスのみを対象とする
  - CI環境判定（process.env.CI）に基づくレポーター動的切り替えを実装する（ローカル: line、CI: github）
  - 失敗時スクリーンショット自動保存（screenshot: 'only-on-failure'）を設定する
  - HTMLレポートも併用して全実行結果を保存する
  - _Requirements: 6.1, 6.3, 6.4, 6.5, 7.2, 7.3_

- [ ] 3. ゲーム基本動作E2Eテストの実装
- [ ] 3.1 テストファイルの基盤とヘルパー関数の作成
  - 単一ファイル（game-basic.spec.ts）にテストスイート構造を定義する
  - data-testid属性を使用したセレクター定数を定義する（game-board, message-box, セル特定など）
  - 共通ヘルパー関数を実装する: tapValidMove（有効手タップ）、waitForAITurn（AIターン待機）、waitForPlayerTurn（プレイヤーターン待機）、getStoneCount（石数取得）
  - 各テストの前処理（beforeEach）でページ遷移とゲーム初期化を行う
  - _Requirements: 6.2, 6.6_

- [ ] 3.2 初期盤面表示テストの実装
  - 8x8のゲームボードが表示されることを検証する
  - 初期4石（黒2個、白2個）が中央の正しい位置に配置されていることを検証する
  - 有効な手のヒント（data-valid="true"）が表示されていることを検証する
  - ターン表示が「あなたのターン」になっていることを検証する
  - _Requirements: 1.1, 1.2, 1.3, 1.4_

- [ ] 3.3 石配置・反転テストの実装
  - 有効な手のマスをtap()でタップし、石が配置されることを検証する
  - 挟まれた相手の石が自分の色に反転することを検証する
  - 石数カウント表示（aria-label）が正しく更新されることを検証する
  - _Requirements: 2.1, 2.2, 2.3_

- [ ] 3.4 ターン切替テストの実装
  - プレイヤーが石を置いた後、ターン表示が「AIのターン」に変わることを検証する
  - AIが応手を完了した後、ターン表示が「あなたのターン」に戻ることを検証する
  - プレイヤーターン中に有効な手のヒントが表示されていることを検証する
  - AIターン中に有効な手のヒントが非表示であることを検証する
  - _Requirements: 3.1, 3.2, 3.3, 3.4_

- [ ] 3.5 無効な手への対応テストの実装
  - 既に石があるマスをタップした際にエラーメッセージが表示されることを検証する
  - 石を反転できないマスをタップした際にエラーメッセージが表示されることを検証する
  - MessageBoxの表示検証ではopacity状態を確認してアニメーション中の可視性を正しく判定する
  - エラー表示後もゲームが継続可能であること（有効な手が打てること）を検証する
  - _Requirements: 4.1, 4.2, 4.3_

- [ ] 3.6 AI対戦（2往復）テストの実装
  - プレイヤーの1手目に対してAIが応手することを検証する
  - AIの1手目応手完了後、プレイヤーが2手目を打てることを検証する
  - プレイヤーの2手目に対してAIが2手目の応手を完了することを検証する
  - AIが思考中に「思考中」表示が表示されることを検証する
  - AI応答が3秒以内に完了することをタイムアウト設定で保証する
  - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 4. E2Eテストの動作確認
  - ローカル環境でテストを実行し、全テストケースがパスすることを確認する
  - lineレポーター形式で結果が出力されることを確認する
  - 両デバイス（Pixel 5、iPhone 12）でテストが実行されることを確認する
  - _Requirements: 6.1, 6.3_
