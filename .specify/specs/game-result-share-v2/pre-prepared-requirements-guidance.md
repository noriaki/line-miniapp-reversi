# 要件定義ガイダンス: ゲーム結果シェア機能

このドキュメントは `/kiro:spec-requirements` エージェントが最適な要件を導出するためのガイダンスです。

---

## ユーザーコンテキスト

### ペルソナ

- **プレイヤー**: リバーシをプレイし、勝利/敗北/引き分けの結果を友人に共有したい
- **シェア受信者**: LINEやSNSでシェアを受け取り、ゲームに興味を持つ潜在ユーザー

### ユーザージャーニー

1. プレイヤーがAIとリバーシ対戦を完了
2. ゲーム終了画面でシェアボタンを確認
3. 「LINEでシェア」または「その他でシェア」を選択
4. シェア先を選択して送信
5. 受信者がリンクをタップしてシェアページを閲覧
6. 受信者が「遊ぶ」ボタンでゲームを開始

---

## 機能領域の探索ポイント

### 1. シェアトリガー

- ゲーム終了をどのように検知し、シェアUIを表示するか
- シェアボタンの配置とデザイン（LINE緑、その他は別色）
- Web Share API非対応環境での代替表示

### 2. LINEシェアフロー

- LINEログイン状態による分岐をどう扱うか
- Flex Message形式の必須要素は何か
- `liff.shareTargetPicker()` の制約と要件

### 3. Web Shareフロー

- URL + テキストのみでのシェア（画像Blobは不使用）
- `navigator.share()` の対応状況チェック
- シェアテキストに含めるべき情報

### 4. シェアページ

- URLアクセス時に表示すべき情報
- OGP（Open Graph Protocol）タグの要件
- ゲーム開始への導線（CTA）

### 5. シェア画像

- 画像に含めるべき要素（盤面、スコア、勝敗、ブランド）
- 画像サイズとアスペクト比（OGP標準: 1200x630）
- 視覚的な魅力と情報の明確さのバランス

---

## 非機能要件の検討ポイント

### パフォーマンス

- シェアボタン表示までの許容遅延
- OG画像生成の許容レスポンス時間

### 互換性

- LINEアプリ内ブラウザでの動作
- 外部ブラウザ（Safari、Chrome）での動作
- iOS/Android両対応

### セキュリティ

- URLエンコードの改ざん検知は必要か
- 不正なエンコード文字列へのアクセス処理

---

## 除外すべき機能（Non-Goals）

以下は明示的にスコープ外として要件に含めないこと:

- シェアテキストのユーザーカスタマイズ
- シェア履歴の保存・表示
- シェア回数のトラッキング/分析
- 対人戦時の対戦相手情報表示
- ローカルへの画像ダウンロード機能
- ログインリダイレクト後のシェア自動継続（PendingShareStorage）

---

## 既存コードベースの参照

要件定義時に参照すべき既存パターン:

- `/src/hooks/useLiff.ts` - LIFFログイン状態管理の既存パターン
- `/src/hooks/useMessageQueue.ts` - トースト通知の既存パターン
- `/src/hooks/useGameState.ts` - ゲーム終了判定ロジック
- `/src/lib/game/types.ts` - Board, Player, GameStatus型定義

---

## 質問事項（要件定義時に検討）

1. シェア成功/失敗時のフィードバックはどの程度詳細にすべきか
2. ユーザーがシェアをキャンセルした場合の挙動は
3. シェアページへの直接アクセス時、ゲームへの誘導はどう行うか
